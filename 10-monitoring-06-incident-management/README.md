# Домашнее задание к занятию "10.06. Инцидент-менеджмент"

## Задание 1

Составьте постмортем, на основе реального сбоя системы Github в 2018 году.

Информация о сбое доступна [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/) , а
также [развёрнуто на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

---

### Ответ

Воспользовавшись [английской версией](https://github.blog/2018-10-30-oct21-post-incident-analysis/)
описания происшедшего, составим **постмортем**:

| Раздел                | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|:----------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Описание**          | Отображение пользователям устаревшей информации. Отсутствие обработки событий хуков, сборки проектов и публикации GitHub Pages.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 
| **Предшествовавшее**  | Выход из строя оборудования оптической связи, восстановленный в течение 43 секунд.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Причина**           | Выбор лидера кластер совпал со сбоем оборудования связи между регионами. В результате набор кластеров БД, ответственных за чтение данных и оркеструемых с применением Raft-консенсуса, оказался в несогласованном состоянии.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Воздействие**       | В течение 24 часов и 11 минут пользователям отображалась устаревшая информация несмотря на то, что целостность БД не была нарушена.<br/>События хуков не обрабатывались, сборка проектов и публикация GitHub Pages не работали. 5 миллионов событий хуков и 80 тысяч страниц GitHub Pages оказались в отложенном состоянии.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Обнаружение**       | Инцидент был выявлен системой мониторинга и замечен дежурными инженерами.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Реакция**           | Инженеры немедленно приступили к анализу ситуации и, видя распространение деградации по системе, вручную выключили механизмы репликации. Координатор инцидента перевел систему в "красное" состояние.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Восстановление**    | Учитывая выбор, сделанный в пользу целостности данных, система была остановлена, приведена в целостное состояние и поэтапно введена в действие с резервированием накопленных данных и отложенным выполнением накопившихся задач.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Таймлайн**          | 2018-10-21 22:52 Выход из строя оборудования оптической связи инициировал процесс назначения нового лидера;<br/>2018-10-21 22:54 Система внутреннего мониторинга сигнализирует о множественных ошибках;<br/>2018-10-21 23:02 Дежурные инженеры обнаруживают несогласованность топологии кластеров БД;<br/>2018-10-21 23:07 Во избежание дальнейшего распространения несогласованности дежурная команда вручную блокирует инструментарий внутреннего развертывания;<br/>2018-10-21 23:11 К решению проблемы присоединяется координатор инцидента;<br/>2018-10-21 23:13 Координатор инцидента принимает решение изменить статус системы на "красный". Дежурные инженеры начинают расследование;<br/>2018-10-21 23:19 Степень деградации системы вынуждает команду остановить процессы записи метаданных, сделав выбор в пользу целостности данных в ущерб функциональности. Работа вебхуков и GitHub Pages остановлена;<br/>2018-10-22 00:05 Инженеры начинают разрабатывать план восстановления системы. Пользователи информируются о том, что система будет контролируемо остановлена;<br/>2018-10-22 00:41 Начат процесс бэкапа. Команды инженеров работают над планом скорейшего восстановления системы без риска её деградации;<br/>2018-10-22 06:51 Ряд кластеров завершают восстановление, что приводит к замедлению загрузки некоторых страниц, но информация на них начинает отображаться корректно. Кластеры крупных БД всё еще в процессе восстановления;<br/>2018-10-22 07:46 GitHub публикует пост с объяснениями;<br/>2018-10-22 11:12 Часть БД восстановлена, что приводит к ускорению работы ряда сервисов, но часть кластеров всё еще не реплицировалась;<br/>2018-10-22 13:15 GitHub сталкивается эффектом пикового отложенного траффика;<br/>2018-10-22 16:24 Реплики синхронизированы, что позволяет запустить процесс восстановления топологии серверов и резервирования данных, накопленных за время простоя. Статус сервисов всё еще "красный";<br/>2018-10-22 16:45 Вся экосистема находится в состоянии повышенной нагрузки и необходимости перебалансировки;<br/>2018-10-22 23:03 Целостность системы восстановлена, все отложенные события выполнены, статус возвращен в "зеленый". |
| **Предпринятые меры** | Подкорректированы процедуры оркестрации, чтобы выбор лидера с одновременным выходом из строя систем связи не приводил к рассогласованности кластеров между регионами;<br/>Внедрена система статусов для разных компоненов системы, вместо статуса всей системы в целом;<br/>Увеличена избыточность систем связи и датацентров;<br/>Внедрена практика систематической оценки негативных сценариев до того, как они могут повлиять на работу системы.<br/>Внедряется симуляция сценариев сбоев и хаос-инжениринг.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

---
